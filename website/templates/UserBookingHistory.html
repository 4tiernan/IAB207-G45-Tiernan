{% extends 'base.html' %}

{% block title %}My Bookings - FitTogether{% endblock %}

{% block content %}
<div class="container py-4">

  <!-- Breadcrumb -->
  <nav id="breadcrumbNav" class="mb-3" aria-label="breadcrumb">
    <ol class="breadcrumb small">
      <li class="breadcrumb-item"><a id="breadcrumbHome" href="{{ url_for('main.index') }}">Home</a></li>
      <li class="breadcrumb-item"><a id="breadcrumbDashboard" href="#">Dashboard</a></li>
      <li class="breadcrumb-item active" aria-current="page">My Bookings</li>
    </ol>
  </nav>

  <!-- Header and controls -->
  <div id="headerControls" class="d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-3 mb-4">
    <h1 class="h3 m-0">My Booked Events</h1>

    <div id="searchSortContainer" class="d-flex gap-2">
      <div id="searchGroup" class="input-group">
        <input id="searchInput" type="text" class="form-control" placeholder="Search booked events…" aria-label="Search events">
        <span id="searchIcon" class="input-group-text"><i class="bi bi-search"></i></span>
      </div>

      <select id="sortSelect" class="form-select" style="max-width: 220px;" aria-label="Sort bookings">
        <option selected>Sort: Most recent</option>
        <option>Sort: Oldest</option>
        <option>Sort: Event date (soonest)</option>
      </select>
    </div>
  </div>

  <!-- Booked Events Grid -->
  {% if bookings %}
  <div id="bookedEventsGrid" class="row g-4">
    {% for booking in bookings %}
    {% set event = booking.event %}
    {% set imgs = (event.images or '').split(',') %}

    <div id="bookedEventCard-{{ booking.id }}" class="col-12 col-sm-6 col-lg-4">
      <div class="card h-100 shadow-sm">
        <div class="ratio ratio-16x9">
          {% if imgs and imgs[0] %}
          <img id="bookedEventImage-{{ booking.id }}" src="{{ url_for('static', filename='uploads/' ~ imgs[0]) }}" class="card-img-top object-fit-cover" alt="{{ event.title }}">
          {% else %}
          <img id="bookedEventPlaceholder-{{ booking.id }}" src="{{ url_for('static', filename='img/placeholder-event.png') }}" class="card-img-top object-fit-cover" alt="Event image placeholder">
          {% endif %}
        </div>

        <div class="card-body d-flex flex-column">
          <div class="d-flex justify-content-between align-items-start mb-2">
            <h2 id="bookedEventTitle-{{ booking.id }}" class="h6 card-title mb-0">
              <a id="bookedEventLink-{{ booking.id }}" href="{{ url_for('main.eventdetails', event_id=event.id) }}" class="stretched-link text-decoration-none">
                {{ event.title }}
              </a>
            </h2>
            <span id="bookedEventStatus-{{ booking.id }}" class="badge text-bg-success">
              {{ 'Upcoming' if event.start_time > now() else 'Past' }}
            </span>
          </div>

          <ul id="bookedEventDetails-{{ booking.id }}" class="list-unstyled small mb-3">
            <li><strong>Booked on:</strong> {{ booking.booking_date.strftime('%d %b %Y, %H:%M') }}</li>
            <li><strong>Event date:</strong> {{ event.start_time.strftime('%d %b %Y, %H:%M') }}</li>
            <li><strong>Tickets:</strong> {{ booking.tickets_booked }} × Standard</li>
            <li><strong>Price:</strong> ${{ '%.2f'|format(event.ticket_price) }}</li>
          </ul>

          <div class="mt-auto d-flex gap-2">
            <a id="viewEventButton-{{ booking.id }}" class="btn btn-outline-primary btn-sm" href="{{ url_for('main.eventdetails', event_id=event.id) }}">View Event</a>
            <a id="contactHostButton-{{ booking.id }}" class="btn btn-outline-secondary btn-sm" href="#">Contact Host</a>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <p id="noBookingsMessage" class="text-muted">You haven’t booked any events yet.</p>
  {% endif %}

  <!-- Pagination -->
  <nav id="paginationNav" aria-label="Bookings pages">
    <ul class="pagination justify-content-center gap-2 my-4">
      <li class="page-item disabled">
        <a id="prevPageButton" class="page-link" href="#" tabindex="-1" aria-disabled="true" aria-label="Previous page">
          <i class="bi bi-chevron-left me-2" aria-hidden="true"></i>Previous
        </a>
      </li>

      <li class="page-item active" aria-current="page">
        <span id="currentPageIndicator" class="page-link">1</span>
      </li>
      <li class="page-item"><a id="page2Button" class="page-link" href="#" aria-label="Go to page 2">2</a></li>
      <li class="page-item"><a id="page3Button" class="page-link" href="#" aria-label="Go to page 3">3</a></li>

      <li class="page-item">
        <a id="nextPageButton" class="page-link" href="#" aria-label="Next page">
          Next<i class="bi bi-chevron-right ms-2" aria-hidden="true"></i>
        </a>
      </li>
    </ul>
  </nav>
</div>
{% endblock %}